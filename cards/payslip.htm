<style>
  .card > .header > .action-right.square { 
    border-radius: 0px;
  }
</style>

<div class='header'>payslip visualisation
  <span id="payslipType" class="action-right" onclick="payslip.flipVisType()">sunburst <i class="fa fa-refresh"></i></span>
</div>
<div class='article chart'>
  <div id='payslipId' style="width: 360px; height: 360px; margin: 0 auto;"></div>
  <p style="text-align: center;">Previously with <a href='https://plotly.com/javascript/' target='_blank'>Plotly</a>, now using <a href='https://echarts.apache.org/en/index.html' target='_blank'>eCharts</a></p>
</div>

<script type="text/javascript">
      
      let payslip = {};

      payslip.currency = 'â‚¬';

      payslip.data = [
        {
          name: 'uniform\nloon', // newline (/n) should be inserted via a data post processing, replacing 'all' spaces
          children: [
            { name: 'salaris', value: 1500.00},
            { name: 'overwerk', value: 500}
          ]
        },
        {
          name: 'inhoudingen',
          children: [
            { name: 'loonheffing', value: 646.17 },
            { name: 'pensioen\ninhouding', value: 209 }
          ]
        },
        {
          name: 'netto',
          children: [
            { name: 'netto', value: 1144.83 }
          ],
        }
      ];

      payslip.chart = echarts.init( document.getElementById('payslipId'));
      
      payslip.option = {
        
        series: [
          {
            type: 'sunburst', // 'treemap'
            data: payslip.data,
            nodeClick: false,
            emphasis: { focus: 'none' },
            itemStyle: {
              borderWidth: 4,
              borderRadius: '5%' // has no effect in Treemap 
            },
            cursor: 'help',
            // sunburst specific
            startAngle: -90,
            sort: null, // use squareRatio to mimic no sorting for treemap, see later
            levels: [
              {},
              {
                r: '35%',
                label: { rotate: 'horizontal'}
              },
              {
                r0: '35%', 
                r: '90%'
              }],
            // treemap specific
            squareRatio: 1, // to get the items in the treemap somehow sorted (earnings left, deductions & net right). Dirty.
            breadcrumb: { show: false}
            // by the way, also no nice animation for treemap, works fine for sunburst
          }
        ],
        color: [ "#009FC2", "#f25752", "#91cd97"],  // base color of earnings, deductions and green for net
        tooltip: {
          trigger: 'item',
          valueFormatter: (value) => payslip.currency + value.toFixed(2)
        }
      };

      payslip.chart.setOption( payslip.option);

      payslip.flipVisType = function() {
        const nowVisType = payslip.option.series[0].type;
        const newVisType = nowVisType == 'treemap' ? 'sunburst' : 'treemap';
        payslip.option.series[0].type = newVisType;

        const eleVisType = document.getElementById('payslipType');

        if (newVisType == 'treemap') {
          eleVisType.classList.add('square');
        } else {
          eleVisType.classList.remove('square');
        }
        
        eleVisType.innerHTML = newVisType + ' <i class="fa fa-refresh"></i>';
        
        payslip.chart.setOption( payslip.option);
      }
    </script>
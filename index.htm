<!doctype html> <html lang=en>
  <head> <meta charset=utf-8>
    
    <title>opayra</title>
    
    <meta name="description" content="opayra thierry vergult popay ebs oracle ebusiness suite">
    
    <meta name="viewport" content="width=device-width">
    <meta name="mobile-web-app-capable" content="yes">
    
    <link rel="icon" type="image/svg+xml" href="./assets/favicon.svg">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    
    <style>
      /* global css variable */
      :root {
        --main-color: #009FC2;
      }
      
      .container {
        display: grid;
        grid-gap: 30px;
        grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
        grid-template-rows: repeat( 1, minmax(200px, 1fr));
        font-family: QuicksandBook, Arial, sans-serif;
      }
      
      .card > .header {
        color: white;
        font-weight: bold;
        background-color: var( --main-color);
        padding: 20px;
      }

      .card > .header > .note-right {
        float: right;
        color: var( --main-color);
        font-weight: bold;
        background-color: white;
        padding-left: 8px;
        padding-right: 8px;
        padding-top: 4px;
        padding-bottom: 2px;
        margin-top: -4px;
        border-radius: 10px;
      }
      
      .card .article {
        color: var( --main-color);
        padding: 20px;
      }
      
      .card a {
        color: var( --main-color);
        font-weight: bold;
        text-decoration: inherit;
      }
      
      .card .right {
        text-align: right;
        float: right;
      }

    </style>
  </head>
  
  <body>
    <div class='container'>
      <div class='card'  id='welcome'>
        <div class='header'>welcome</div>
        <div class='article'>
          <div>Opayra is the company behind Thierry Vergult.</div>
          <p>HR &amp; Payroll expertise since 1998.
          <ul class="fa-ul">
            <li><i class="fa-li fa fa-check-square-o"></i>project management</li>
            <li><i class="fa-li fa fa-check-square-o"></i>technical development</li>
            <li><i class="fa-li fa fa-check-square-o"></i>functional design</li>
          </ul>
          <p>And rolling out projects in Europe and <a href="#africa">Africa</a> since.</p>
        </div>
      </div>
      
      <div class='card' id='admin'>
        <div class='header'>admin</div>
        <div class='article'>
          <i class="fa fa-pencil fa-2x"></i>
          <div class='right'>
            <div>opayra bv</div>
            <div>dok-noord 17</div>
            <div>9000 gent</div>
            <p>BE 0864.183.787</p>
            <a href="mailto:thierry+site@opayra.com"><i class="fa fa-envelope-o"></i></a>
          </div>
        </div>
      </div>
      
      <div class='card' id='now'>
        <div class='header'>now</div>
        <div class='article'>
          <i class="fa fa-calculator fa-2x"></i>
          <div style="padding-top: 10px; padding-bottom: 20px;">
            Actual focus is on payroll and data visualisations.
          </div>
          <div style="text-align: right;">
            <i class="fa fa-line-chart fa-2x"></i>
          </div>
        </div>
      </div>
      
      <div class='card' id='blog'>
        <script>
          function handleBloggerResponse(response) {
            
            var feed = response.items;
            console.log( 'blog feeds found: ' + feed.length);
            
            // create a top 3 list.
            
            document.getElementById("idBlogTitles").innerHTML = '<ul>';
            
            for ( i = 0 ; i < 3; i++) {
              document.getElementById("idBlogTitles").innerHTML += "<li>" + feed[i].title;
            }
            
            document.getElementById("idBlogTitles").innerHTML += '</ul>';
            
          }
        </script>

        <div class='header'>blog</div>
        <div class='article'>
          From the time before social networks, here some <a href="http://oraclehrms.blogspot.com" target="_blank">blog posts</a>.
          <div id="idBlogTitles"></div>
        </div>

        <!-- my blog id is 5750484 (log in into blogger, and see the id in the url ) 
             the api key is generated in console.developers.google.com -->
        <script src="https://www.googleapis.com/blogger/v3/blogs/5750484/posts?callback=handleBloggerResponse&key=AIzaSyDqfppxCtpfDu-e8RVkcR4KF6Nt_6SU548"></script>
      </div>
      
      <div class='card' id='headcount'>
        <div class='header'>headcount visualisation</div>
        <div class='article'>
          <div>
            <img src="./assets/in_out.jpg" style="width:100%;">
          </div>
        
        </div>
      </div>

      <div class='card' id='payslip'>
        <style>
          input[type='radio']:checked:after {
            width: 15px;
            height: 15px;
            top: -6px;
            left: -8px;
            position: relative;
            background-color: var( --main-color);
            content: '';
            display: inline-block;
            visibility: visible;
            border: 4px solid white;
          }

          input[value='sunburst']:after {
            border-radius: 15px;
          }
        </style>

        <script src='https://cdn.plot.ly/plotly-latest.min.js'></script>

        <div class='header'>payslip visualisation</div>
        <div class='article'>
          <label for="sunburst"></label><input type="radio" name="trace" value="sunburst" onclick="show_payslip(value);" checked="checked">sunburst</label>
          <label for="treemap"></label><input type="radio" name="trace" value="treemap"  onclick="show_payslip(value);">treemap</label>

          <div id='payBurst' style="width: 360px; margin: 0 auto;"></div>
        </div>

        <script>
          function show_payslip( traceType) {
            //console.log( traceType);
            data[0].type = traceType;

            if (traceType == 'treemap') {
              data[0].labels[0] = 'Uniform loon';
            }
            Plotly.newPlot( 'payBurst', data, layout, config);
          }

          var data = [{
            type: "sunburst",
            ids: [ "earnings", "net", "deductions", "earn01", "earn02", "deduct01", "deduct02", "net00"],
            labels: [ "Uniform<br>loon", "netto", "Inhoudingen", "Maandloon", "Gewerkte<br>uren", "zvw", "loonheffing", " "],
            parents: [ "", "", "", "earnings", "earnings", "deductions", "deductions", "net"],
            values:  [2000, 1144.83, 855.17, 1500, 500, 109.00, 746.17, 1144.83],
            outsidetextfont: {size: 20, color: "#377eb8"},
            leaf: {opacity: 0.7},
            marker: {
                      line: {width: 6},
                      colors: [ "#009FC2","#91cd97","#f25752"]
                    },
            branchvalues: 'total',
            textposition: 'middle center',
            sort: false, // hey hey, this is mine
            rotation: 90, // hey hey
            root: { color: "#009FC2"} // hey
          }];
          
          var layout = {
            margin: {l: 0, r: 0, b: 0, t: 0},
            width: 320,
            height: 320
          };

          var config = {
            modeBarButtonsToRemove: [ 'toggleHover']
          }
          
          var traceType = document.querySelector('input[name="trace"]:checked').value;
          show_payslip( traceType);

        </script>
      </div>

      <div class='card' id='africa'>
          <link rel="stylesheet" href="./assets/map.css">
  
          <script src="//cdnjs.cloudflare.com/ajax/libs/d3/6.1.1/d3.min.js"></script>
          <script src="//cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js"></script>

        <div class='header'>payroll in africa</div>
        <div class='article'>
          <div id="map"></div>
          <script src="./assets/map.js"></script>
        </div>
      </div>
      
      <div class='card' id='apex'>
        <div class='header'>apex on apps</div>
        <div class='article'>
          <a href="http://sites.google.com/a/popay.be/apex-on-apps/integration" target="_blank">More info</a>
          to integrate apex, aka
          <a href="http://apex.oracle.com" target="_blank">Oracle application express</a>, with Oracle's eBusiness suite.
        </div>
      </div>

      <div class='card'>
        <div class='header'>documentool</div>
        <div class='article'>
          <a href="http://www.documentool.com" target="_blank">Documentool</a> generates your Oracle eBusiness suite Hr &amp; Payroll setup documentation.
          <p></p>
          <img src="./assets/documentoolLoop.gif" width="100%">
        </div>
      </div>

      <div class='card' id='techno'>
        <div class='header'>techno</div>
        <div class='article'>
          <ul class="fa-ul">
            <li><i class="fa-li fa fa-check-square-o"></i>oracle database</li>
            <li><i class="fa-li fa fa-check-square-o"></i>html5</li>
            <li><i class="fa-li fa fa-check-square-o"></i>javascript</li>
            <li><i class="fa-li fa fa-check-square-o"></i>oracle application express (apex)</li>
            <li><i class="fa-li fa fa-check-square-o"></i>plsql</li>
            <li><i class="fa-li fa fa-check-square-o"></i>d3</li>
          </ul>
        </div>
      </div>

      <div class='card' id='knaak'>
        <div class='header'>nl tax - knaak
          <span id="taxYear" class="note-right" onclick="flipYear()">1999</span>
        </div>
        <div class='article'>
          <p>Bereken loonheffing &amp; sv premies</p>
          <ul>
            <li>witte maandtabel
            <li>jonger dan de AOW leeftijd
            <li>woonland Nederland
          </ul>
          <br>
          <p>uniform loon
            <input type="number" id="brutoLoon" name="brutoLoon" min="0" max="999999" onchange="nlTaxHtml()">
            <br><br>
            <ul>
              <li>loonheffing</li>
              <ul>
                <li id="tax01"><i class="fa fa-question"></i>
                <li id="tax02"><i class="fa fa-question"></i>
              </ul>
              <li>sv bedragen
              <ul>
                <li id="zvwl"><i class="fa fa-question"></i>
                <li>werkgeverslasten &nbsp; &nbsp; <small><small>23.22%</small></small>
                <ul>
                  <li id="wgl-wab-laag"><i class="fa fa-question"></i>
                  <li id="wgl"><i class="fa fa-question"></i>
                  </ul>
                </ul>
            </ul>
          </p>

          <br>
          <i>sql-webservice on a public google sheet.</i>
          
          <script>
            // set tax year, based upon current year
            document.getElementById("taxYear").innerHTML = new Date().getFullYear();
            
            function flipYear() {
              var taxY = Number( document.getElementById("taxYear").innerText);
              
              taxY = 2020 + ( (taxY + 1) % 2);
              
              document.getElementById("taxYear").innerHTML = taxY;

              nlTaxHtml();
            }

            function euro2id( id, txt, amount, plus) {
              var extra = '';
              if (plus) {
                extra = '&nbsp; <small>&EqualTilde;</small>';
              }

              document.getElementById(id).innerHTML = txt + ' : &euro;' + amount.toFixed(2) + extra;
            }

            function nlTaxHtml() {
              var brutoLoon = Number( document.getElementById("brutoLoon").value);
              var taxY = Number( document.getElementById("taxYear").innerText);

              console.log( 'bruto=' + brutoLoon + ' year=' + taxY);

              nlTax( brutoLoon, taxY);
            }

            function nlTax( brutoLoon, year) {
              
              var queryString = encodeURIComponent('SELECT C, D where A <= ' + brutoLoon + ' and B >= ' + brutoLoon);
              var url = 'https://docs.google.com/spreadsheets/d/195Am8WL7nybm4mUgUSVbG8kYB-Ob6kts5T3iVj-YQAQ/gviz/tq?tqx=out:csv&range=A2:D4000' 
                      + '&sheet=' + year 
                      + '&tq=' + queryString;
      
              console.log( 'url to google sheet with sql:'+ url);
      
              fetch( url)
              .then( response => response.text())
              .then( function (data) {
      
                console.log( '1 line csv from google sheet: ' + data);
                var taxValues = data.split(',');
                
                var tax_zonder_lhk = parseFloat( taxValues[0].replace( /"/g, ''));
                var tax_met_lhk = parseFloat( taxValues[1].replace( /"/g, ''));
                //console.log( tax_zonder_lhk + ' - ' + tax_met_lhk + ' : delta=' + (tax_zonder_lhk - tax_met_lhk));

                var taxPlus = false;

                const taxMax = 8235;
                const taxPctOverMax = 49.5 / 100;

                if ( brutoLoon > taxMax) {
                  tax_zonder_lhk = tax_zonder_lhk + (brutoLoon - taxMax) * taxPctOverMax;
                  tax_met_lhk = tax_zonder_lhk;
                  taxPlus = true;
                }

                euro2id( 'tax01', 'geen loonheffingskorting', tax_zonder_lhk, taxPlus);
                euro2id( 'tax02', 'met loonheffingskorting', tax_met_lhk, taxPlus);

                const svMaxMonthBase = 4769.33;
                const pctZvwl = 5.45 / 100;
                const pctWgl = 23.22 / 100;
                const deltaWabLaag = 5 / 100;

                svLoon = brutoLoon;
                svPlus = false;

                if (brutoLoon > svMaxMonthBase) {
                  svLoon = svMaxMonthBase;
                  svPlus = true;
                }
                var zvwl = svLoon * pctZvwl;
                var wgl = svLoon * pctWgl;
                var wgl_wabLaag = svLoon * ( pctWgl - deltaWabLaag);

                euro2id( 'zvwl', 'inhouding zvw', zvwl, svPlus);
                euro2id( 'wgl-wab-laag', 'wab laag', wgl_wabLaag, svPlus);
                euro2id( 'wgl', 'wab hoog', wgl, svPlus);
      
              });
      
            }
      
          </script>

        </div>
      </div>
      
    </div>
    
  </body>
</html>

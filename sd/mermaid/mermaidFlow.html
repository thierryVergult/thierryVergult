<!DOCTYPE html>
<html>
  <head>
    <style>
      .radioSpan {
        display: inline-flex;
        width: 180px;
      }

      .mmTitle {
        margin-left: 10%;
        font-size: 20px;
      }

      #L-sdc-payroll-0:hover {
        stroke: green!important;
        stroke-width:5px!important;
      }

    </style>
  </head>
  <body>

    <p>Please select the type of offering:</p>
      <input type="radio" name="offering" id="gro" value="gro"><label for="gro">local solution</label><br>
      <input type="radio" name="offering" id="flo" value="flo"><label for="flo">FLO</label><br>
      <input type="radio" name="offering" id="pro" value="pro" checked><label for="pro">PRO</label><br>
    
    <p><span class="radioSpan">Include Protime</span>
      <input type="radio" name="protime" id="pt-y" value="y" checked><label for="pt-y">Yes</label>
      <input type="radio" name="protime" id="pt-n" value="n"><label for="pt-n">No</label>
    </p>

    <p><span class="radioSpan">Data enrichment</span>
      <input type="radio" name="enrich" id="ri-y" value="y" checked><label for="ri-y">Yes</label>
      <input type="radio" name="enrich" id="ri-n" value="n"><label for="ri-n">No</label>
    </p>

    <p><span class="radioSpan">Point-to-point interface</span>
      <input type="radio" name="p2p" id="p2p-y" value="y"><label for="p2p-y">Yes</label>
      <input type="radio" name="p2p" id="p2p-n" value="n" checked><label for="p2p-n">No</label>
    </p>

    <p">country &nbsp; &nbsp;<input type="text" id="country" name="country"></p>

    <h3>Map payroll output</h3>

    <p><span class="radioSpan">GL Posting goes to</span>
      <input type="radio" name="gl" id="gl-mft"   value="mft"><label for="gl-mft">MFT</label>
      <input type="radio" name="gl" id="gl-mysp2" value="mysp2"><label for="gl-mysp2">My Service Point</label>
      <input type="radio" name="gl" id="gl-mysd"  value="mysd"><label for="gl-mysd">sd Worx Portal</label>
    </p>

    <p><span class="radioSpan">SEPA goes to</span>
      <input type="radio" name="sepa" id="sepa-mft" value="mft"><label for="sepa-mft">MFT</label>
      <input type="radio" name="sepa" id="sepa-mysp2" value="mysp2"><label for="sepa-mysp2">My Service Point</label>
      <input type="radio" name="sepa" id="sepa-mysd" value="mysd"><label for="sepa-mysd">sd Worx Portal</label>
    </p>

    <p><span class="radioSpan">Payslips goes to</span>
      <input type="radio" name="slip" id="slip-mft" value="mft"><label for="slip-mft">MFT</label>
      <input type="radio" name="slip" id="slip-mysp2" value="mysp2"><label for="slip-mysp2">My Service Point</label>
      <input type="radio" name="slip" id="slip-mysd" value="mysd" checked><label for="slip-mysd">sd Worx Portal</label>
    </p>

    <p><span class="radioSpan">Calculated data goes to</span>
      <input type="radio" name="calc" id="calc-mft" value="mft"><label for="calc-mft">MFT</label>
      <input type="radio" name="calc" id="calc-mysp2" value="mysp2"><label for="calc-mysp2">My Service Point</label>
      <input type="radio" name="calc" id="calc-mysd" value="mysd"><label for="calc-mysd">sd Worx Portal</label>
    </p>

    <p><span class="radioSpan">Reporting goes to</span>
      <input type="radio" name="rep" id="rep-mft" value="mft"><label for="rep-mft">MFT</label>
      <input type="radio" name="rep" id="rep-mysp2" value="mysp2"><label for="rep-mysp2">My Service Point</label>
      <input type="radio" name="rep" id="rep-mysd" value="mysd"><label for="rep-mysd">sd Worx Portal</label>
    </p>

    <br>
    <button style="margin: 10px; color: white; background-color: silver;" onclick="$mm.renderDiagram('mm-id', 'sd', setParametersFromUi);">render</button>

    <div id="mm-id" style = "border:3px solid silver"></div>

    <br>
    <p>to do :</p>
    <ul>
      <li>more generic approach so to push to the q page
      <li>hover
    </ul>

    <br>
    <a href="https://mermaid.js.org/syntax/flowchart.html" target="_blank">Mermaid flowchart documentation</a>

    <script src='./sdii_mermaid.js'></script>

    <script>
      function setParametersFromUi () {
        
        $mm.offering = document.querySelector( 'input[name="offering"]:checked').value;
        
        $mm.protime  = document.querySelector('input[name="protime"]:checked').value == 'y' ? true : false;

        $mm.enrich   = document.querySelector('input[name="enrich"]:checked').value == 'y' ? true : false;

        $mm.point2p  = document.querySelector('input[name="p2p"]:checked').value == 'y' ? true : false;

        $mm.country  = document.querySelector('input[name="country"]').value;
      
        //$mm.point2pName
        //$mm.erpName
        //$mm.lpeName
        
        if ($mm.point2pName)
        {
          $mm.nodes['p2p'] = '(point-to-point<br>' + $mm.point2pName +')';
        }

        if ($mm.erpName)
        {
          $mm.nodes['erp'] = $mm.nodes['erp'].replace('workday', $mm.erpName);
        }

        if ($mm.lpeName)
        {
          let payroll = ($mm.nodes['payroll'] || '{payroll}');
          $mm.nodes['payroll'] = [payroll.slice(0,-1), '<br>', $mm.lpeName, payroll.slice(-1)].join('');
        }
        
        // set payroll output destinations
        setLinkToFromRadio( 'gl');
        setLinkToFromRadio( 'sepa');
        setLinkToFromRadio( 'rep', 'reporting');
        setLinkToFromRadio( 'slip', 'payslips');
        setLinkToFromRadio( 'calc');

      }
    </script>

    <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10.0.2/+esm';
      mermaid.initialize({ startOnLoad: false});

      $mm = await getJSON( './mm_config.json');

      $mm.renderDiagram = async function (idHtml, idSvg, setParameters) { 
        setParameters();
        const { svg } = await mermaid.render( idSvg, sdMarkdown());
        injectSvg( svg, idHtml);
      }
      
    </script>

  </body>
</html>
<!doctype html>
  <html lang=en>
  <head>
    <meta charset=utf-8>
    <title>sol arch - questionnaire</title>

    <style>
      body {
        margin: 20px;
      }

      .offering {
        background-color: steelblue;
        color: white;
      }

      .offering>td {
        padding: 5px;
        padding-top: 10px;
      }

      td[title] {
        font-weight: bold;
      }

      input[type='checkbox'] { 
        margin-left: 20%;
      }

      .review-sol-arch {
        background-color: khaki;
      }

      .sol-answer {
        text-align: center; 
        color:steelblue;
      }

      .review-sol-arch>td {
        padding: 5px;
        padding-top: 10px;
      }

      .sol {
        border-left: 1px solid steelblue;
        padding-left: 4px;
      }

      .mmTitle {
        margin-left: 10%;
        font-size: 20px;
      }

      .radioSpan {
        display: inline-flex;
        width: 180px;
      }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  </head>
  
  <body>
    <div>
      <span>Customer profile &nbsp; &nbsp;</span>
      <span><input type="text" id="customer" name="customer"></span>
    </div>
    <br>

    <button onclick="copyColumn();">Add country / step</button>

    <br><br>
    <div>
      <table>
        <tr>
          <td>Country</td>
          <td id="id-c01-q01"><input type="text"></td>
        </tr>
        <tr>
          <td>LPE</td>
          <td id="id-c01-q02"><input type="text"></td>
        </tr>
        <tr>
          <td title="Use this, in case a country is first implemented as GRO - templated,&#10; and then upgraded to FLO/PRO">step</td>
          <td id="id-c01-q03"><input type="number" min="1" max="2" value="1"></td>
        </tr>
        <tr>
          <td>Headcount</td>
          <td id="id-c01-q04"><input type="number"></td>
        </tr>
        <tr>
          <td>Offering</td>
          <td id="id-c01-q05">
            <input type="radio" name="offering-col01" value="gro" onchange="setReadOnly( this.dataset.colnr, this.value);"><label>GRO</label><br>
            <input type="radio" name="offering-col01" value="flo" onchange="setReadOnly( this.dataset.colnr, this.value);"><label>FLO</label><br>
            <input type="radio" name="offering-col01" value="pro" onchange="setReadOnly( this.dataset.colnr, this.value);"><label>PRO</label>
          </td>
        </tr>

        <tr class="offering">
          <td><div style="float:left;">GRO</div><div style="text-align:right;">local</div></td>
          <td id="id-c01-gro"></td>
        </tr>
      
        <tr>
          <td>with point-to-point?</td>
          <td id="id-c01-q06" class="gro"><input type="checkbox"></td>
        </tr>
        
        <tr class="offering">
          <td><div style="float:left;">FLO</div><div style="text-align:right;">ERP to LPE</div></td>
          <td id="id-c01-flo"></td>
        </tr>

        <tr>
          <td class="sol">ERP</td>
          <td id="id-c01-q07" class="flo"><input list="erps" onchange="calcSolArch( this.dataset.colnr);"></td>
        </tr>
        <tr>
          <td>Protime?</td>
          <td id="id-c01-q08" class="flo"><input type="checkbox"></td>
        </tr>
        <tr>
          <td class="sol">Other T&A tool?</td>
          <td id="id-c01-q09" class="flo"><input type="checkbox" onchange="calcSolArch( this.dataset.colnr);"></td>
        </tr>
        <tr>
          <td class="sol">Other inbound interfaces?</td>
          <td id="id-c01-q10" class="flo"><input type="checkbox" onchange="calcSolArch( this.dataset.colnr);"></td>
        </tr>
        <tr>
          <td>with Data Enichment? (SDWP)</td>
          <td id="id-c01-q11" class="flo"><input type="checkbox"></td>
        </tr>
        <tr>
          <td class="sol">Readiness not OK?</td>
          <td id="id-c01-q12" class="flo"><input type="checkbox" onchange="calcSolArch( this.dataset.colnr);"></td>
        </tr>

        <tr class="offering">
          <td><div style="float:left;">PRO</div><div style="text-align:right;">SD Worx People</div></td>
          <td id="id-c01-pro"></td>
        </tr>

        <tr>
          <td>Protime?</td>
          <td id="id-c01-q13" class="pro"><input type="checkbox"></td>
        </tr>
        <tr>
          <td class="sol">Other T&A tool?</td>
          <td id="id-c01-q14" class="pro"><input type="checkbox" onchange="calcSolArch( this.dataset.colnr);"></td>
        </tr>
        <tr>
          <td  class="sol" title="inbound & outbound,&#10; but no payroll output">Other interfaces?</td>
          <td id="id-c01-q15" class="pro"><input type="checkbox" onchange="calcSolArch( this.dataset.colnr);"></td>
        </tr>
        <tr>
          <td class="sol">Move not only basic HR to SDWP?</td>
          <td id="id-c01-q16" class="pro"><input type="checkbox" onchange="calcSolArch( this.dataset.colnr);"></td>
        </tr>
        <tr>
          <td class="sol" title="- low: Excel, Office driven, a lot of manual work&#10;- medium&#10;- high">Complexity of actual HR landscape</td>
          <td id="id-c01-q17" class="pro"><input list="complexities" onchange="calcSolArch( this.dataset.colnr);"></td>
        </tr>
        <tr>
          <td class="sol">Readiness not OK?</td>
          <td id="id-c01-q18" class="pro"><input type="checkbox" onchange="calcSolArch( this.dataset.colnr);"></td>
        </tr>

        <tr class="review-sol-arch">
          <td>Review with solution architect</td>
          <td id="id-c01-sol" class="sol-answer">-</td>
        </tr>
      </table>
    </div>

    <datalist id="erps">
      <option value="Workday">
      <option value="SuccessFactors">
      <option value="Others">
    </datalist>

    <datalist id="complexities">
      <option value="Low">
      <option value="Medium">
      <option value="High">
    </datalist>

    <br><br><br>
    
  </body>

  <script>
    iiSol = {};
    iiSol.colCount = 1;

    // set the column nr on all elements & children of column 1.
    let col1 = document.querySelectorAll('[id^="id-c01-"]');
    for (let i=0; i < col1.length; i++) {
      let ele_from_col1 = col1[i];
      ele_from_col1.setAttribute('data-colnr', iiSol.colCount);
      
      for (const child of ele_from_col1.children) {
        child.setAttribute('data-colnr', iiSol.colCount);
      }
    }

    function copyColumn() {

      iiSol.colCount = iiSol.colCount + 1;

      let col1 = document.querySelectorAll('[id^="id-c01-"]');
      
      for (let i=0; i < col1.length; i++) {
        let table_data = col1[i];
        //console.log( table_data.id);

        let table_row = table_data.closest('tr');
        //console.log( table_row);

        let clone = table_data.cloneNode(true);
        clone.id = table_data.id.replace( 'c01', 'c' + String( iiSol.colCount).padStart(2, '0'));

        clone.setAttribute('data-colnr', iiSol.colCount);

        for (const child of clone.children) {
          //console.log(child.tagName, child.name);
          child.setAttribute('data-colnr', iiSol.colCount);

          if (child.name === 'offering-col01') {
            child.name = 'offering-col' + String( iiSol.colCount).padStart(2, '0');
          }
        }

        table_row.appendChild(clone);
      }
    };

    function disableCells(bool, offering, colNr) {
      // has class offering and the child has the correct colnr
      let selector = "." + offering + " [data-colnr='" + colNr + "']";
      console.log( selector, bool);

      let matches = document.querySelectorAll( selector);
      console.log( matches.length, matches);

      for (var i = 0; i < matches.length; i++) {
        matches[i].disabled=bool;
      }
    }

    function setReadOnly (colNr, offering) {
      console.log('set read only', colNr, offering);

      
      disableCells( true, 'gro', colNr);
      disableCells( true, 'flo', colNr);
      disableCells( true, 'pro', colNr);
      

      disableCells( false, offering.toLowerCase(), colNr);
    }

    function solArchDifferentFrom( pColNr, pQuestionNr, pCompare, pNote) {
      let plus = 0;
      const id = 'id-c' + String( pColNr).padStart(2, '0') + '-q'  + String( pQuestionNr).padStart(2, '0');
      const val = document.getElementById( id).firstChild.value;
      
      if ( val && val.toLowerCase() != pCompare.toLowerCase()) {
        console.log( 'Sol Arch in column', pColNr, ':', val, pNote);
        plus = 1;
      }

      return plus;
    }

    function solArchBool( pColNr, pQuestionNr, pNote) {
      let plus = 0;
      const id = 'id-c' + String( pColNr).padStart(2, '0') + '-q'  + String( pQuestionNr).padStart(2, '0');
      const bool = document.getElementById( id).firstChild.checked;
      
      if ( bool) {
        console.log( 'Sol Arch in column', pColNr, ':', pNote);
        plus = 1;
      }

      return plus;
    }

    function calcSolArch( pColNr) {
      
      //console.log( 'soll', pColNr, pTopic, pValue, pNote);
      let score = 0;

      // all ERP except Workday
      score = score + solArchDifferentFrom( pColNr,  7, 'Workday', 'erp');

      score = score + solArchBool( pColNr,  9, 'other T&A');
      score = score + solArchBool( pColNr, 10, 'other interface');
      score = score + solArchBool( pColNr, 12, 'flo readiness');

      score = score + solArchBool( pColNr, 14, 'other T&A');
      score = score + solArchBool( pColNr, 15, 'other interface');
      score = score + solArchBool( pColNr, 16, 'not only basic HR');
      score = score + solArchBool( pColNr, 18, 'gro readiness');

      // all complexities except low
      score = score + solArchDifferentFrom( pColNr, 17, 'Low', 'complexity');
      
      console.log( 'final score on column', pColNr, ':', score);

      let id = 'id-c' + String( pColNr).padStart(2, '0') + '-sol';
      if (score > 0) {
        document.getElementById(id).innerHTML = '<i class="fa fa-calendar-plus-o"></i>';
      } else {
        document.getElementById(id).innerHTML = '-';
      }
      
    }
  </script>
  
  <h2>Flow diagram</h2>
  <br>
  <button id="id-mm-button" style="margin: 10px; background-color: khaki; padding: 10px;" onclick="$mm.renderDiagram('mm-id', 'sd', setParametersFromUi);">render diagram</button>
  <div><input id="id-colnr-mermaid" type="number" min="1" max="20" value="1" style="margin-left: 15px;" onchange="setButton(this.value)">&nbsp; column nr</div>
  <br>
  <h3>Map payroll output</h3>

    <p><span class="radioSpan">GL Posting goes to</span>
      <input type="radio" name="gl" id="gl-mft"   value="mft"><label for="gl-mft">MFT</label>
      <input type="radio" name="gl" id="gl-mysp2" value="mysp2"><label for="gl-mysp2">My Service Point</label>
      <input type="radio" name="gl" id="gl-mysd"  value="mysd"><label for="gl-mysd">sd Worx Portal</label>
    </p>

    <p><span class="radioSpan">SEPA goes to</span>
      <input type="radio" name="sepa" id="sepa-mft" value="mft"><label for="sepa-mft">MFT</label>
      <input type="radio" name="sepa" id="sepa-mysp2" value="mysp2"><label for="sepa-mysp2">My Service Point</label>
      <input type="radio" name="sepa" id="sepa-mysd" value="mysd"><label for="sepa-mysd">sd Worx Portal</label>
    </p>

    <p><span class="radioSpan">Payslips goes to</span>
      <input type="radio" name="slip" id="slip-mft" value="mft"><label for="slip-mft">MFT</label>
      <input type="radio" name="slip" id="slip-mysp2" value="mysp2"><label for="slip-mysp2">My Service Point</label>
      <input type="radio" name="slip" id="slip-mysd" value="mysd" checked><label for="slip-mysd">sd Worx Portal</label>
    </p>

    <p><span class="radioSpan">Calculated data goes to</span>
      <input type="radio" name="calc" id="calc-mft" value="mft"><label for="calc-mft">MFT</label>
      <input type="radio" name="calc" id="calc-mysp2" value="mysp2"><label for="calc-mysp2">My Service Point</label>
      <input type="radio" name="calc" id="calc-mysd" value="mysd"><label for="calc-mysd">sd Worx Portal</label>
    </p>

    <p><span class="radioSpan">Reporting goes to</span>
      <input type="radio" name="rep" id="rep-mft" value="mft"><label for="rep-mft">MFT</label>
      <input type="radio" name="rep" id="rep-mysp2" value="mysp2"><label for="rep-mysp2">My Service Point</label>
      <input type="radio" name="rep" id="rep-mysd" value="mysd"><label for="rep-mysd">sd Worx Portal</label>
    </p>
  <br>
  <div id="mm-id" style = "border:3px solid silver"></div>

  <script src='./sdii_mermaid.js'></script>

  <script>
    function setButton (colNr) {
      colNr = colNr.padStart(2, '0');
      let country = document.getElementById( 'id-c' + colNr + '-q01').firstChild.value
      document.getElementById( 'id-mm-button').textContent = "render diagram for " + country;

      if (! document.querySelector( 'input[name="offering-col' + colNr + '"]:checked')) {
        alert( 'Please precise offering for column ' + parseInt(colNr) + ' - ' + country);
      }

      $mm.renderDiagram('mm-id', 'sd', setParametersFromUi);
    }

    function setParametersFromUi () {

      let colNr = document.getElementById( 'id-colnr-mermaid').value.padStart(2, '0');

      let offering = document.querySelector( 'input[name="offering-col' + colNr + '"]:checked');
      if (offering) {
        $mm.offering = document.querySelector( 'input[name="offering-col' + colNr + '"]:checked').value;
      } else {
        alert( 'Please precise offering for column ' + parseInt(colNr));
      }
        
      $mm.protime  = solArchBool( colNr, 8) + solArchBool( colNr, 13) > 0 ? true : false;

      $mm.enrich   = solArchBool( colNr, 11) > 0 ? true : false;
      
      $mm.point2p  = solArchBool( colNr, 6) > 0 ? true : false;

      $mm.country  = document.getElementById( 'id-c' + colNr + '-q01').firstChild.value;

      $mm.erpName  = document.getElementById( 'id-c' + colNr + '-q07').firstChild.value;

      $mm.lpeName  = document.getElementById( 'id-c' + colNr + '-q02').firstChild.value;
      
      //$mm.point2pName
        
      if ($mm.point2pName)
      {
        $mm.nodes['p2p'] = '(point-to-point<br>' + $mm.point2pName +')';
      }

        if ($mm.erpName)
        {
          $mm.nodes['erp'] = '((' + $mm.erpName + '))';
        }

        if ($mm.lpeName)
        {
          let payroll = ($mm.nodes['payroll'] || '{payroll}');
          $mm.nodes['payroll'] = [payroll.slice(0,-1), '<br>', $mm.lpeName, payroll.slice(-1)].join('');
        }
        
        // set payroll output destinations
        setLinkToFromRadio( 'gl');
        setLinkToFromRadio( 'sepa');
        setLinkToFromRadio( 'rep', 'reporting');
        setLinkToFromRadio( 'slip', 'payslips');
        setLinkToFromRadio( 'calc');
        
      }
  </script>

  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10.0.2/+esm';
    mermaid.initialize({ startOnLoad: false});

    $mm = await getJSON( './mm_config.json');

    $mm.renderDiagram = async function (idHtml, idSvg, setParameters) { 
      setParameters();
      const { svg } = await mermaid.render( idSvg, sdMarkdown());
      injectSvg( svg, idHtml);
    }
    
  </script>
</html>